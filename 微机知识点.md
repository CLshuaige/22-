# 内部结构

## 40个引脚

1. 32个I/O口

   1. P0，地址/数据复用（ALE控制）；IO口，作输入口时，先写 “1”

   2. P1，I/O口，输入先写 ‘’1‘’

   3. P2，I/O口和P1一致；可作 *地址高八位*

   4. P3，I/O口和P1一致；第二功能口

      | 口线 | 第二功能       | 口线 | 第二功能              |
      | ---- | -------------- | ---- | --------------------- |
      | P3.0 | RXD串行输入    | P3.4 | T0外部计数器0触发输入 |
      | P3.1 | TXD串行输出    | P3.5 | T1                    |
      | P3.2 | /INT0外部中断0 | P3.6 | /WR                   |
      | P3.3 | /INT1外部中断1 | P3.7 | /RD                   |

      *注释* ：P0驱动8个LSTTL，其余4个

2. 2个时钟电路

3. Vcc、Vss

4. 4个控制信号

   1. RST复位信号
   2. ALE地址锁存信号：*P0* 高电平出现地址信息，下降沿送出地址；低电平：指令和数据
   3. /PSEN片外ROM读选
   4. /EA内外ROM选择信号：/EA高电平，<4KB内部,>4KB外部；/EA低电平，外部ROM

   

## SFR

​	P44

# 定时/计数器

TMOD

| GATE | C/(/T) | M1   | M0   | GATE | C/(/T) | M1   | M0   |
| ---- | ------ | ---- | ---- | ---- | ------ | ---- | ---- |

GATE：门控位。“1”：计时器受外部中断控制，/TNTx = 1 才能中断

C/(/T)：定时器方式选择。“0”：定时器，内部12分频；“1”：外部脉冲

| M1 M0  | 操作方式 | 功能                                |
| ------ | -------- | ----------------------------------- |
| 0    0 | 0        | 13位计数器：0000 0000 xxx0 0000     |
| 0    1 | 1        | 16位计数器                          |
| 1    0 | 2        | 可自动装载的8位计数器               |
| 1    1 | 3        | T0分为两个独立8位计数器，T1停止计数 |

------



TCON

| TF1        | TR1                | TF0  | TR0  | IE1              | IT1      | IE0  | IT0  |
| ---------- | ------------------ | ---- | ---- | ---------------- | -------- | ---- | :--: |
| T1溢出标志 | T1启停控制、可编程 | 同   | 同   | 外部中断请求标志 | 触发方式 | 同   |  同  |



# 串行口

**SCON**

| SM0  | SM1  | SM2            | REN            | TB8         | RB8           | TI                                          | RI                 |
| ---- | ---- | -------------- | -------------- | ----------- | ------------- | ------------------------------------------- | ------------------ |
| /    | /    | 多机通信控制位 | 允许接收控制位 | 发送的第9位 | 接收到的第9位 | 发送中断标志，第八位结束硬件置 1 ，软件清零 | 接收中断标志，同上 |

**SM2:**

方式2或3中，若SM2 = 1，接收到RB8 = 1时，置位RI = 1

​						若SM2 = 0，均置位RI

方式1中	  ，若SM2 = 1，只有接收到有效停止位时，才置位RI，否则RI清零

方式0中	  ，SM2应为 0



| SM0  | SM1  | 方式 | 功能说明                      |
| ---- | ---- | ---- | ----------------------------- |
| 0    | 0    | 0    | 移位寄存器，IO扩展            |
| 0    | 1    | 1    | 8位，波特率可变，TI溢出率/n   |
| 1    | 0    | 2    | 9位，波特率为fosc/64或fosc/32 |
| 1    | 1    | 3    | 9位，波特率可变，TI溢出率/n   |



**PCON**

​	SMOD波特率选择位，SMOD = 1，波特率加倍

**波特率设计**，	P175



# 中断系统

TCON，如上

SCON，如上

IE中断允许寄存器

| EA     | /    | *ET2 | ES     | ET1  | EX1   | ET0  | EX0   |
| ------ | ---- | ---- | ------ | ---- | ----- | ---- | ----- |
| 总允许 | /    | T2   | 串行口 | T1   | /INT1 | T0   | /INT0 |



IP中断优先级寄存器

| /    | /    | PT2  | PS     | PT1  | PX1   | PT0  | PX0   |
| ---- | ---- | ---- | ------ | ---- | ----- | ---- | ----- |
| /    | /    | T2   | 串行口 | T1   | /INT1 | T0   | /INT0 |



**总体逻辑结构**，P185

**中断源矢量单元**，P186



# 常用指令集

## 数据传输

```assembly
MOV					;
MOVC				;查表
MOVX				;外部
PUSH
POP
XCH	A,(R,direct,@R)	;交换
XCHD				;低位交换
```

## 算术运算

```assembly
ADD					
ADDC
SUBB
INC
DEC
MUL	AB
DIV	AB
DA	A				;对A进行BCD调整，把16进制当十进制计算
```

## 逻辑运算和移位指令

```assembly
ANL	A,(R,direct,@R,#data)	;与，A<-()
ANL	direct,(A,#data)
ORL							;或
XRL							;异或
CLR							;清零
CPL							;取反
RL
RR
RLC
RRC
SWAP						;高4位和第4位互换
```

## 控制转移

```
AJMP	addr11
LJMP	addr16
SJMP	rel
JMP		@A+DPTR
JZ		rel				;A=0，跳转，Z=Zero
JNZ						;A≠0，跳转
CJNE					;不相等，跳转，前大于后则Cy=0，否则Cy=1
DJNZ
ACALL	addr11
LCALL	addr16
RET
RETI
NOP
```

## 位操作

```assembly
CLR	(C/bit)
SETB
CPL
ANL	C,(bit,/bit)
ORL
MOV	C(bit),bit(C)
JC	rel				;Cy=1，跳转
JNC	rel
JB	bit,rel
JNB	bit,rel
JBC	bit,rel			;(bit)=1,跳转，并且bit置0
```

